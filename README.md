# Домашнее задание Сартисона Евгения №4 #


Высокая доступность: развертывание Patroni

Цель:
развернуть отказоустойчивый кластер PostgreSQL с Patroni;

Описание/Пошаговая инструкция выполнения домашнего задания:
"BananaFlow" вышла на новый рынок — Австралию. В день запуска платформы в Австралии количество запросов к базе данных выросло в 10 раз. База данных не выдержала нагрузки: один из серверов вышел из строя, и система была недоступна в течение нескольких часов.

Поставщик "GreenBanana Co." из Сиднея не получил вовремя информацию о заказе на 10 тонн бананов. В результате, бананы не были доставлены к началу фестиваля "BananaFest", который ежегодно проводится в Сиднее. Организаторы фестиваля были вынуждены закупать бананы у конкурентов по завышенным ценам, а "GreenBanana Co." потеряла контракт на следующий год.

Алексей понял, что нужно срочное решение. Он решил развернуть высокодоступный кластер на основе Patroni, чтобы обеспечить отказоустойчивость и бесперебойную работу базы данных.

Однако на пути к успеху его ждали новые вызовы:
***Как правильно настроить кластер из трёх узлов?***
***Как обеспечить синхронизацию данных между узлами?***
***Как проверить отказоустойчивость системы?***
Алексей знал, что от его действий зависит успех компании: если кластер будет работать стабильно, это позволит избежать сбоев и сохранить репутацию "BananaFlow".


## (1) Создайте 3 виртуальные машины для etcd и 3 виртуальные машины для Patroni.
Для экономии времени и упрощения конфигурирования, создали 3 виртуальные машины для Postgres+Patroni и одну отдельную для HaProxy в YC 
![image](https://github.com/user-attachments/assets/6e6dab44-1d42-4441-80d1-db29bac76294)

| Machine  | Private IP |
| ------------- | ------------- |
| pgnode1  | 192.168.0.24  |
| pgnode2  | 192.168.0.25  |
| pgnode3  | 192.168.0.26  |
| pghaproxy1  | 192.168.0.30  |




## (2) Разверните HA-кластер PostgreSQL с использованием Patroni.

## (3) Настройте HAProxy для балансировки нагрузки.

## (4) Проверьте отказоустойчивость кластера, имитируя сбой на одном из узлов.

## (5) Дополнительно: Настройте бэкапы с использованием WAL-G или pg_probackup.
